<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Construye tu primer 101 sistema de monitorización - Blog de Angulito</title><meta name=viewport content="width=device-width,initial-scale=1"><meta property=og:title content="Construye tu primer 101 sistema de monitorización"><meta property=og:description content="En esta entrada puedes seguir un rápido tutorial sobre como configurar fácilmente tu primer sistema de monitorización usando herramientas como Prometheus, Grafana y Alertmanager. En la primera parte, podrás aprender sobre qué son exactamente estas herramientas. En la segunda parte, te redirigiré a una guía práctica (proyecto de Github) que contiene la documentación necesaria para configurar el sistema de monitorización desde cero en aproximadamente 30 minutos.
Contenido  Teoría: Qué herramientas de monitorización vamos a usar  Prometheus Métricas PromQL Alertmanager Grafana  Práctica: Como configurar tu sistema de monitorización Invítame a una caña  Qué herramientas de monitorización vamos a usar Hemos elegido un stack tecnológico dentro de muchas posibilidades que tenemos."><meta property=og:type content=article><meta property=og:url content=http://example.org/es/technology/prometheus/><meta property=article:published_time content=2020-05-09T00:00:00+00:00><meta property=article:modified_time content=2020-05-09T00:00:00+00:00><meta property=og:site_name content="Blog de Angulito"><meta name=twitter:card content=summary><meta name=twitter:title content="Construye tu primer 101 sistema de monitorización"><meta name=twitter:description content="En esta entrada puedes seguir un rápido tutorial sobre como configurar fácilmente tu primer sistema de monitorización usando herramientas como Prometheus, Grafana y Alertmanager. En la primera parte, podrás aprender sobre qué son exactamente estas herramientas. En la segunda parte, te redirigiré a una guía práctica (proyecto de Github) que contiene la documentación necesaria para configurar el sistema de monitorización desde cero en aproximadamente 30 minutos.
Contenido  Teoría: Qué herramientas de monitorización vamos a usar  Prometheus Métricas PromQL Alertmanager Grafana  Práctica: Como configurar tu sistema de monitorización Invítame a una caña  Qué herramientas de monitorización vamos a usar Hemos elegido un stack tecnológico dentro de muchas posibilidades que tenemos."><link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:200,300" rel=stylesheet><link rel=stylesheet type=text/css media=screen href=http://example.org/css/normalize.css><link rel=stylesheet type=text/css media=screen href=http://example.org/css/main.css><link rel=stylesheet type=text/css href=http://example.org/[%3cabsolute%20path%20to%20CSS%3e%20/static/css/test.css%20%3cor%20just%20load%20it%20off%20the%20internet%3e]><script src=https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js></script><script src=http://example.org/js/main.js></script></head><body><div class="container wrapper post"><div class=header><h1 class=site-title><a href=http://example.org/>Blog de Angulito</a></h1><div class=site-description><nav class="nav social"><ul class=flat><a class=link-header href=https://twitter.com/nangulito><i data-feather=twitter></i></a><a class=link-header href=https://github.com/angulito><i data-feather=github></i></a><a class=link-header href=https://www.paypal.me/angulito/2>Invítame a una caña
<img class=img-header src=/img/beer-icon.png width=20px alt=Beer></a>
<a><img class=img-header src=/language/lan.png width=15px alt=Languages><li><a class=link-header href=http://example.org/en/technology/prometheus/>English</a></li></a></ul></nav></div><nav class=nav><ul class=flat><li><a href=http://example.org/es/>Inicio</a></li><li><a href=http://example.org/es/trips>Viajes</a></li><li><a href=http://example.org/es/technology>Tecnología</a></li><li><a href=http://example.org/es/categories>Categorias</a></li><li><a href=http://example.org/es/tags>Etiquetas</a></li><li><a href=http://example.org/es/contact>Contacto</a></li></ul></nav></div><div class=post-header><h1 class=title>Construye tu primer 101 sistema de monitorización</h1><div class=meta>Publicado en &mdash; 9 Mayo 2020</div></div><div class=markdown><p>En esta entrada puedes seguir un rápido tutorial sobre como configurar fácilmente tu primer sistema de monitorización usando herramientas como Prometheus, Grafana y Alertmanager. En la primera parte, podrás aprender sobre qué son exactamente estas herramientas. En la segunda parte, te redirigiré a una guía práctica (proyecto de Github) que contiene la documentación necesaria para configurar el sistema de monitorización desde cero en aproximadamente 30 minutos.</p><h1 id=contenido>Contenido</h1><ul><li><a href=#que-herramientas-de-monitorizacion-vamos-a-usar>Teoría: Qué herramientas de monitorización vamos a usar</a><ul><li><a href=#prometheus>Prometheus</a></li><li><a href=#metricas>Métricas</a></li><li><a href=#promql>PromQL</a></li><li><a href=#alertmanager>Alertmanager</a></li><li><a href=#grafana>Grafana</a></li></ul></li><li><a href=#como-configurar-tu-sistema-de-monitorizacion>Práctica: Como configurar tu sistema de monitorización</a></li><li><a href=#invítame-a-una-caña>Invítame a una caña</a></li></ul><h2 id=qué-herramientas-de-monitorización-vamos-a-usar>Qué herramientas de monitorización vamos a usar</h2><p>Hemos elegido un stack tecnológico dentro de muchas posibilidades que tenemos. Lo que queremos conseguir es tener un sistema de monitorización para que seamos capaces de representar métricas además de tener alertas de nuestros servicios. Entonces, podremos conseguir información tanto de la perspectiva de infrastructura como de negocio.</p><h3 id=prometheus>Prometheus</h3><p><a href=https://prometheus.io/docs/introduction/overview/>Prometheus</a> es un sistema de monitorización y alertas de <strong>código libre</strong>. Él reúne información de servicios y jobs instrumentados. Para instrumentar un servicio, simplemente tenemos que exponer un endpoint HTTP con métricas en el formato de Prometheus. Es entonces cuando usando el servicio de autodiscovery de Prometheus podemos almacenar las métricas recolectada de todos nuestros objetivos. Por otro lado, si tenemos jobs de vida corta, necesitaremos usar el servicio de <a href=https://prometheus.io/docs/practices/pushing/>Pushgateway</a>. En este caso, el servicio de Pushgateway será el responsable de exponer las métricas a los servicios. Aquí puedes ver algunos diagramas de como funciona:</p><p>Cómo reunir métricas sobre servicios:<figure><img src=/technology/prometheus/scrapping.png><figcaption><h4>Prometheus escanea la información de los servicios</h4></figcaption></figure></p><p>Cómo Prometheus Pushgatway reúne las métricas de los jobs de vida corta:<figure><img src=/technology/prometheus/scrapping-push-gateway.png><figcaption><h4>Prometheus Gateway recibe las métricas de los jobs de vida corta</h4></figcaption></figure></p><h4 id=metricas>Metricas</h4><p>Una métrica es un dato que:</p><ul><li>Contiene características del sistema.</li><li>Provee una secuencia de valores almacenados a lo largo de un periodo.</li></ul><p>Ejemplo de una métrica para un servidor web:</p><ul><li>Número total de peticiones recibidas.</li></ul><p>En Prometheus, una métrica está compuesta por:</p><ul><li>Nombre de la métrica: Necesita representar a qué refiere una métrica. Hay un <a href=https://prometheus.io/docs/practices/naming/>listado de mejores prácticas disponible</a>.</li><li>Tipo de métrica: Dependiendo de qué datos queremos representar con nuestra métrica, necesitaremos un tipo de métrica u otra. En general, los tipos de métrica más usados son los contadores (counter), medidores (gauge) y los histogramas (histogram). Echa un vistazo a los <a href=https://prometheus.io/docs/concepts/metric_types/>diferentes tipos de métricas disponibles</a>.</li><li>Etiquetas: Cada métrica tiene unas etiquetas (labels), las cuales añaden dimensiones a la métrica. Para cada nueva etiqueta, un nuevo valor de la métrica se creará. Ten en cuenta que si <a href=https://www.robustperception.io/cardinality-is-key>una métrica tiene muchas dimensiones</a>, esto hará que la consulta de datos sea muy cara.</li><li>Descripción de la métrica: Para proveer más información sobre lo que representa. Esta información no es recolectada por Prometheus, pero la podemos ver cuando consultamos el endpoint de métricas de nuestro servicio.</li></ul><p>Aquí puedes ver un diagrama sobre la estructura de una métrica:</p><figure><img src=/technology/prometheus/metric.png><figcaption><h4>Estructura de una métrica</h4></figcaption></figure><h4 id=promql>PromQL</h4><p>Prometheus usa su propio lenguaje para consultar los datos: <a href=https://prometheus.io/docs/prometheus/latest/querying/basics/>PromQL</a>. En él, puedes usar:</p><ul><li><a href=https://prometheus.io/docs/prometheus/latest/querying/operators/#aggregation-operators>Operadores de agregación</a>:<ul><li>sum, min, max, avg, count…</li></ul></li><li><a href=https://prometheus.io/docs/prometheus/latest/querying/basics/#functions>Funciones</a>:<ul><li>histogram_quantile(φ float, b instant-vector): calcula el φ-cuantil (0 ≤ φ ≤ 1)</li><li>rate(v range-vector): media de la tasa de incremento por segundo en una serie temporal dado un rango de vectores.</li><li>increase(v range-vector): incremento en la serie temporal dado un rango de vectores.</li><li>&hellip;</li></ul></li></ul><h3 id=alertmanager>Alertmanager</h3><p>Alertmanager es un kit de herramientas de Prometheus que podemos usar para manegar alertas a través de reglas simplemente consultado la base de datos de Prometheus y estableciendo unos límites. Alertmanager tiene un simple <a href=https://prometheus.io/docs/alerting/configuration/>sistema de notificación</a>, el cual soporta muchos servicios como Slack y Jira.</p><figure><img src=/technology/prometheus/alertmanager.png><figcaption><h4>Alertmanager</h4></figcaption></figure><h3 id=grafana>Grafana</h3><p>Grafana nos permite consultar, visualizar, alertar y entender nuestras métricas sin importar dónde están almacenadas. Gracias a Grafana, podemos crear, explorar y compartir dashboards consultado nuestras métricas. Puedes echar un vistazo a un ejemplo visual <a href=https://play.grafana.org>https://play.grafana.org</a>.</p><h2 id=como-configurar-tu-sistema-de-monitorización>Como configurar tu sistema de monitorización</h2><p>Para construir tu primer sistema de monitorización usando las herramientas mencionadas anteriormente, he creado un projecto de Github qu contiene un detallado pero rápido tutorial acerca de cómo puedes hacerlo <a href=https://github.com/angulito/prometheus-101>https://github.com/angulito/prometheus-101</a>. No dudes en contactarme o abrir una pull request si tienes preguntas o sugerencias.</p><h1 id=invítame-a-una-caña>Invítame a una caña</h1><p>¿Te ha gustado este post? ¿Te ha sido de ayuda? ¡Puedes invitarme a una cañeja para ayudarme a digerir mejor el uso de estas nuevas tecnologías!</p><p><a href=https://www.paypal.me/angulito/2><img src=/img/beer-es.png alt="invitame a una cerveza"></a></p></div><div class=post-tags><nav class="nav tags"><ul class=flat><li><a href=/es/tags/monitorizaci%C3%B3n>monitorización</a></li><li><a href=/es/tags/sre>SRE</a></li></ul></nav></div></div><div class="footer wrapper"><nav class=nav><div><a href=https://github.com/vividvilla/ezhil>Ezhil theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></nav></div><script>feather.replace()</script></body></html>