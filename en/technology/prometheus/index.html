<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><base href=https://angulito.github.io/blog/><title>Build your first 101 monitoring system - Angulito&#39;s blog</title><meta name=viewport content="width=device-width,initial-scale=1"><meta property=og:title content="Build your first 101 monitoring system"><meta property=og:description content="In this post you can follow a quick tutorial about how you can easily set up your first monitoring system using tools like Prometheus, Grafana and Alertmanager. On the first part you&rsquo;ll learn about what are exactly these tools and how to use them. On the second part, I&rsquo;ll point out you to my Github project that contains the necessary documentation to set up your first monitoring system from scratch in ~30min."><meta property=og:type content=article><meta property=og:url content=https://angulito.github.io/blog/en/technology/prometheus/><meta property=article:published_time content=2020-05-09T00:00:00+00:00><meta property=article:modified_time content=2020-05-09T00:00:00+00:00><meta property=og:site_name content="Angulito's blog"><meta name=twitter:card content=summary><meta name=twitter:title content="Build your first 101 monitoring system"><meta name=twitter:description content="In this post you can follow a quick tutorial about how you can easily set up your first monitoring system using tools like Prometheus, Grafana and Alertmanager. On the first part you&rsquo;ll learn about what are exactly these tools and how to use them. On the second part, I&rsquo;ll point out you to my Github project that contains the necessary documentation to set up your first monitoring system from scratch in ~30min."><link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:200,300" rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://angulito.github.io/blog/css/normalize.css><link rel=stylesheet type=text/css media=screen href=https://angulito.github.io/blog/css/main.css><link rel=stylesheet type=text/css href=https://angulito.github.io/blog/[%3cabsolute%20path%20to%20CSS%3e%20/static/css/test.css%20%3cor%20just%20load%20it%20off%20the%20internet%3e]><script src=https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js></script><script src=https://angulito.github.io/blog/js/main.js></script></head><body><div class="container wrapper post"><div class=header><h1 class=site-title><a href=https://angulito.github.io/blog/>Angulito&#39;s blog</a></h1><div class=site-description><nav class="nav social"><ul class=flat><a class=link-header href=https://twitter.com/nangulito><i data-feather=twitter></i></a><a class=link-header href=https://github.com/angulito><i data-feather=github></i></a><a class=link-header href=https://www.paypal.me/angulito/2>Buy me a beer
<img class=img-header src=img/beer-icon.png width=20px alt=Beer></a>
<a><img class=img-header src=language/lan.png width=15px alt=Languages><li><a class=link-header href=https://angulito.github.io/blog/es/technology/prometheus/>Español</a></li></a></ul></nav></div><nav class=nav><ul class=flat><li><a href=https://angulito.github.io/blog/en/>Home</a></li><li><a href=https://angulito.github.io/blog/en/trips>Trips</a></li><li><a href=https://angulito.github.io/blog/en/technology>Technology</a></li><li><a href=https://angulito.github.io/blog/en/categories>Categories</a></li><li><a href=https://angulito.github.io/blog/en/tags>Tags</a></li><li><a href=https://angulito.github.io/blog/en/contact>Contact</a></li></ul></nav></div><div class=post-header><h1 class=title>Build your first 101 monitoring system</h1><div class=meta>Posted at &mdash; 9 May 2020</div></div><div class=markdown><p>In this post you can follow a quick tutorial about how you can easily set up your first monitoring system using tools like Prometheus, Grafana and Alertmanager. On the first part you&rsquo;ll learn about what are exactly these tools and how to use them. On the second part, I&rsquo;ll point out you to my Github project that contains the necessary documentation to set up your first monitoring system from scratch in ~30min.</p><h1 id=content>Content</h1><ul><li><a href=#what-monitoring-tools-we-are-going-to-use>Theory: What monitoring tools we are going to use</a><ul><li><a href=#prometheus>Prometheus</a></li><li><a href=#metrics>Metrics</a></li><li><a href=#promql>PromQL</a></li><li><a href=#alertmanager>Alertmanager</a></li><li><a href=#grafana>Grafana</a></li></ul></li><li><a href=#how-to-setup-your-monitoring-system>Practice: How to setup your monitoring system</a></li><li><a href=#buy-me-a-beer>Buy me to a beer</a></li></ul><h2 id=what-monitoring-tools-we-are-going-to-use>What monitoring tools we are going to use</h2><p>The following tech stack is one of a lot of possibilities that you currently have. What we want to achieve is having a monitoring system and be able to represent metrics while having alerts of our services. We can gather information from both an infrastructure and business perspective.</p><h3 id=prometheus>Prometheus</h3><p><a href=https://prometheus.io/docs/introduction/overview/>Prometheus</a> is an <strong>open-source</strong> monitoring and alerting system. It gathers information from instrumented services and jobs. In order to instrument a service just expose an HTTP endpoint with metrics in Prometheus format. Then using Prometheus service discovery, we will be able to discover and automatically scrape and ingest the metrics. On the other hand, if we have a short-lived job, we will need to use the <a href=https://prometheus.io/docs/practices/pushing/>Pushgateway</a> service. The push gateway service is responsible to expose the metrics to Prometheus for scraping. Here you have some diagrams about how it works:</p><p>How to scrape services:<figure><img src=technology/prometheus/scrapping.png><figcaption><h4>Prometheus scrapes a service</h4></figcaption></figure></p><p>How to scrape prometheus Pushgateway as it contains short-lived jobs metrics:<figure><img src=technology/prometheus/scrapping-push-gateway.png><figcaption><h4>Prometheus Gateway for short-lived jobs</h4></figcaption></figure></p><h4 id=metrics>Metrics</h4><p>A metric is a data value that:</p><ul><li>Contains system characteristics.</li><li>Provides a sequence of values recorded over time.</li></ul><p>Example of a metric for a web server:</p><ul><li>Total set of requests received.</li></ul><p>In Prometheus, a metric is composed by:</p><ul><li>Metric name: It needs to represent what the metric refers to. There is a set of <a href=https://prometheus.io/docs/practices/naming/>best practices for naming metrics that are available</a>.</li><li>Metric type: Depending on what data we want to represent with our metric, we will need to use one or another metric type. The most used metric types are counters, gauges and histograms. Take a look at the <a href=https://prometheus.io/docs/concepts/metric_types/>different types that are available</a>.</li><li>Labels: Each metric can have labels, which adds dimensions to the metric. For each new label value, a new metric value will be created. Keep in mind, if <a href=https://www.robustperception.io/cardinality-is-key>a metric has tons of dimensions</a> then querying that data will be expensive.</li><li>Metric description: In order to provide more information about what they represent. This information is not collected by Prometheus, but we can see it when hitting the metrics endpoint for our service.</li></ul><p>Here you have a diagram about the metric structure:</p><figure><img src=technology/prometheus/metric.png><figcaption><h4>Metric structure</h4></figcaption></figure><h4 id=promql>PromQL</h4><p>Prometheus uses its own query language: <a href=https://prometheus.io/docs/prometheus/latest/querying/basics/>PromQL</a>. There you can use:</p><ul><li><a href=https://prometheus.io/docs/prometheus/latest/querying/operators/#aggregation-operators>Aggregation operators</a>:<ul><li>sum, min, max, avg, count…</li></ul></li><li><a href=https://prometheus.io/docs/prometheus/latest/querying/basics/#functions>Functions</a>:<ul><li>histogram_quantile(φ float, b instant-vector): compute φ-cuantil (0 ≤ φ ≤ 1)</li><li>rate(v range-vector): mean of the rate increase per second in the time series in a vector range</li><li>increase(v range-vector): increase in the time series in a vector range.</li><li>&hellip;</li></ul></li></ul><h3 id=alertmanager>Alertmanager</h3><p>Alertmanager is a Prometheus’ toolkit that we can use to handle alerts through rules, just querying prometheus database setting thresholds. Alertmanager has an easy <a href=https://prometheus.io/docs/alerting/configuration/>notification system</a>, supporting a lot of services like Slack and Jira.</p><figure><img src=technology/prometheus/alertmanager.png><figcaption><h4>Alertmanager</h4></figcaption></figure><h3 id=grafana>Grafana</h3><p>Grafana allows us to query, visualize, alert and understand our metrics no matter where they are stored. Thanks to Grafana, we can create, explore, and share dashboards querying our Prometheus metrics. You can look at a GUI example at <a href=https://play.grafana.org>https://play.grafana.org</a>.</p><h2 id=how-to-setup-your-monitoring-system>How to setup your monitoring system</h2><p>In order to build your first monitoring system using these mentioned tools above, I created a Github project that contains a detailed but quick tutorial about how you can do it at <a href=https://github.com/angulito/prometheus-101>https://github.com/angulito/prometheus-101</a>. Don&rsquo;t hesitate to contact me or open a new pull request in case you have any question for me.</p><h1 id=buy-me-a-beer>Buy me a beer</h1><p>Do you like this post? Is it helpful for you? You can buy me a beer to help me to digest better the usage of these new technologies!</p><p><a href=https://www.paypal.me/angulito/2><img src=img/beer.png alt="buy me a beer"></a></p></div><div class=post-tags><nav class="nav tags"><ul class=flat><li><a href=/blog/en/tags/monitoring>monitoring</a></li><li><a href=/blog/en/tags/sre>SRE</a></li></ul></nav></div></div><div class="footer wrapper"><nav class=nav><div><a href=https://github.com/vividvilla/ezhil>Ezhil theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></nav></div><script>feather.replace()</script></body></html>